# 2026-02-21

## Token Count Display Feature

Added token usage tracking and display to session-stream.

### Implementation

- **Parsed usage data** from JSONL entries (`message.usage.input` and `message.usage.output`)
- **Display format**: Compact inline display like "tokens: 1.2k in / 3.4k out" in dim text
- **Location**: After the message header on assistant replies
- **Running total**: Shows cumulative tokens at end when using `--no-follow`

### Code changes

- Added `Usage` struct with `Input`, `Output`, `CacheRead`, `CacheWrite`, `TotalTokens` fields
- Added `Usage *Usage` field to `Message` struct
- Created `formatNumber()` helper to format large numbers (e.g., "1.2k" for 1200)
- Created `formatTokenUsage()` to format the token display string
- Changed `processLine()` to return `ProcessedLine` struct containing both output and usage
- Updated `streamFile()` to track cumulative input/output tokens and display total

### Testing

Tested with:
- `--no-follow` mode: Shows per-message tokens + running total at end
- Follow mode: Shows per-message tokens in real-time
- Multiple agents: Works correctly for both `main` and `session-stream` agents

### Commit

`88a6b28` - "Add token count display to session output"
